<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>金融仪表板 - 账户警报</title>
</head>
<body>
    <h2>账户警报系统</h2>
    <button onclick="connectWallet()">连接钱包</button>
    <br><br>
    <label>交易金额（ETH）：</label>
    <input type="number" id="amount" step="0.01">
    <button onclick="recordTransaction()">提交交易</button>
    <br><br>
    <h3>警报日志：</h3>
    <div id="alerts"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/4.0.1/web3.min.js"></script>
    <script>
        let contract;
        let account;
        const contractAddress = "你的合约地址"; // 替换为实际部署的地址
        const abi = [/* 你的 ABI 代码 */]; // 替换为你的 ABI

        async function connectWallet() {
            if (window.ethereum) {
                const web3 = new Web3(window.ethereum);
                await window.ethereum.request({ method: "eth_requestAccounts" });
                const accounts = await web3.eth.getAccounts();
                account = accounts[0];
                contract = new web3.eth.Contract(abi, contractAddress);
                console.log("钱包已连接:", account);
            } else {
                alert("请安装 MetaMask");
            }
        }

        async function recordTransaction() {
            const amount = document.getElementById("amount").value;
            if (!contract || !account) {
                alert("请先连接钱包");
                return;
            }

            await contract.methods.recordTransaction(Web3.utils.toWei(amount, "ether")).send({ from: account });
            alert("交易已提交");
        }

        async function listenToAlerts() {
            contract.events.AlertTriggered({}).on("data", (event) => {
                const log = `${event.returnValues.reason} (时间: ${new Date(event.returnValues.timestamp * 1000).toLocaleString()})`;
                document.getElementById("alerts").innerHTML += `<p>${log}</p>`;
            });
        }
        
        window.onload = listenToAlerts;
    </script>
</body>
</html>
